<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AnimeStream Free</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; margin: 0; }
    header { background: #222; padding: 15px; text-align: center; }
    input { padding: 8px; width: 60%; max-width: 400px; border-radius: 5px; border: none; }
    button { padding: 8px 12px; border: none; background: crimson; color: white; border-radius: 5px; cursor: pointer; }
    .anime-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; padding: 20px; }
    .anime-card { background: #222; border-radius: 8px; padding: 10px; text-align: center; cursor: pointer; transition: transform 0.2s; }
    .anime-card:hover { transform: scale(1.05); }
    .anime-card img { width: 100%; border-radius: 8px; }
    #episodes { margin: 20px; }
    #episodes button { margin: 4px; padding: 6px 10px; }
    #player { display: none; text-align: center; margin-top: 20px; }
    video { width: 95%; max-width: 800px; border-radius: 10px; background: black; }
  </style>
</head>
<body>
  <header>
    <h1>AnimeStream Free</h1>
    <input id="search" type="text" placeholder="Search anime...">
    <button onclick="searchAnime()">Search</button>
  </header>
  
  <div id="results" class="anime-list"></div>
  <div id="episodes"></div>
  
  <div id="player">
    <h2 id="animeTitle"></h2>
    <video id="animeVideo" controls autoplay></video>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    // ðŸ‘‡ replace this with your deployed vercel URL
    const API_BASE = "https://your-vercel-app.vercel.app/api/proxy?url=";

    async function searchAnime() {
      const query = document.getElementById("search").value.trim();
      if (!query) return;
      const res = await fetch(`${API_BASE}https://api.anify.tv/search?query=${encodeURIComponent(query)}`);
      const data = await res.json();

      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";
      document.getElementById("episodes").innerHTML = "";
      document.getElementById("player").style.display = "none";
      
      data.results.forEach(anime => {
        const card = document.createElement("div");
        card.className = "anime-card";
        card.innerHTML = `<img src="${anime.image}" alt=""><p>${anime.title.english || anime.title.romaji}</p>`;
        card.onclick = () => loadEpisodes(anime.id, anime.title.english || anime.title.romaji);
        resultsDiv.appendChild(card);
      });
    }

    async function loadEpisodes(id, title) {
      const res = await fetch(`${API_BASE}https://api.anify.tv/info/${id}`);
      const data = await res.json();

      const epDiv = document.getElementById("episodes");
      epDiv.innerHTML = `<h3>Episodes of ${title}</h3>`;
      
      data.episodes.forEach(ep => {
        const btn = document.createElement("button");
        btn.innerText = `Ep ${ep.number}`;
        btn.onclick = () => playEpisode(ep.id, title + " - Ep " + ep.number);
        epDiv.appendChild(btn);
      });
    }

    async function playEpisode(episodeId, title) {
      const res = await fetch(`${API_BASE}https://api.anify.tv/sources?episodeId=${episodeId}&providerId=gogoanime`);
      const data = await res.json();

      document.getElementById("animeTitle").innerText = title;
      const player = document.getElementById("player");
      const video = document.getElementById("animeVideo");

      const source = data.sources.find(s => s.type === "hls") || data.sources[0];
      
      if (Hls.isSupported() && source.type === "hls") {
        const hls = new Hls();
        hls.loadSource(source.url);
        hls.attachMedia(video);
      } else {
        video.src = source.url;
      }
      
      player.style.display = "block";
    }
  </script>
</body>
</html>